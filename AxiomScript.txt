## Data

- Axiom PMDA data


## Tools and pipelines

APT - Affymetrix Power Tools: versão apt-2.10.2.2 
Plink - PLINK v1.90p


## Raw data processing to generate genotyping data:
Function: apt-genotype-axiom
https://www.affymetrix.com/support/developer/powertools/changelog/apt-genotype-axiom.html

apt-genotype-axiom is a program for making genotyping calls on the Affymetrix Axiom™ family of arrays. apt-genotype-axiom uses the BRLMM-P algorithm for genotype calling. BRLMM-P is a model- based approach which performs 1-dimensional clustering by fitting a Gaussian mixture model.

1.	Before using APT it is necessary to inform the path where it is:
>export PATH=$PATH:/home/APT/apt-2.10.2.2-x86_64-intel-linux/bin
 

2.	Running

>nohup apt-genotype-axiom --analysis-files-path
  /home/Dados_brutos_axiom/AxiomReference/Axiom_PMDA_Analysis.r7/ --arg-file
/home/Dados_brutos_axiom/AxiomReference/Axiom_PMDA_Analysis.r7/Axiom_PMDA.r
7.apt-genotype-axiom.AxiomCN_GT1.apt2.xml --out-dir
/home/Genotipagem_axiom/ --cel-files
/home/Genotipagem_axiom/patients22.txt --log-file ./apt-genotype-
  axiom_patients22.log &
 
- Should run in 10 minutes

Explanations
--analysis-files-path(dirname) = Default directory to search for analysis library files
--cel-files (string8,required) = The file that identifies the cel files to process.
--arg-file(filename) = Read arguments from this file. File should be a valid XML file, and should contain elements of the form. This is the file that determines the parameters of the genotyping call This file was sent to us along with the axiom data
This generated four output files:

- AxiomGT1.confidences.txt: standard Axiom confidences in flat text file format, with one row per probeset_id and one column per *.CEL. The Axiom GT1 confidences matrix file is similar to the Axiom GT1 calls matrix file,
- except confidence values are given in place of the calls. The confidence score
- = 1- Pr(x), where X is the called genotype. 0 is the highest confidence and 1 is the lowest confidence. Confidence values are similar to p-values, but are not p- values.
- AxiomGT1.report.txt: summary values (call rate, het rate) per sample
- AxiomGT1.calls.txt :standard Axiom genotypes in flat text file format, with one row per probeset_id and one column per *.CEL
- AxiomGT1.summary.a5: binary

3.	Conversion of genotyping to plink format
Function: apt-format-result https://www.affymetrix.com/support/developer/powertools/changelog/apt- format-result.html

apt-format-result is an application which allows for the creation of VCF, or PLINK file formats as well as IGV compatible files from Axiom analyzed batches.

1.	Before using APT it is necessary to inform the path where it is:

>export PATH=$PATH:/home/APT/apt-2.10.2.2-x86_64-intel-linux/bin
 
2.	Make the pedigree file in R to be used in apt-format-result.
If this is not done, the plink will give an error, as the initial 6 columns of the ped file will be missing.

The file was made from the table used for the processing list It must have the columns:

'Affection Status' column. 'Family_ID' column. 'Father_ID' column. 'Individual_ID' column. 'Mother_ID' column. 'Sample Filename' column. 'Sex' column.
Selecionei as colunas de AG e SampleFileName

4. Convert the file with the genotyping call to plink input format.

>apt-format-result --calls-file /home/Genotipagem_axiom/AxiomGT1.calls.txt --annotation-file /home/Dados_brutos_axiom/AxiomReference/Axiom_PMDA.na36.r7.a8.annot.db/Axiom_PMDA.na36.r7.a8.annot.db --snp-identifier-column dbSNP_RS_ID --pedigree-file pedigree_patients.txt --export-plink-file patients

--calls-file (filename) = CallsFile.txt file that was generated by apt2 genotyping software.
--annotation-file (string8) = Full path for annotation file, e.g. sqlite db.
--snp-identifier-column (string8) = Column name to be used as snp identifier for export. Must be one of annotation columns, e.g. {Affy_SNP_ID, dbSNP_RS_ID}.
default value: 'probeset_id
--export-plink-file (string8) = Export results to standard plink format, e.g {MAP, PED}. (standard is sample-based by rows)
--pedigree-file (filename) = Contains basic pedigree information such as identifiers for family, sample, paternal, maternal and etc. Data comes from GUI

This step generated the plink input map and ped files:
patients.map
patients.ped
 

## Quality Control - Plink

APT output files are of ped and map format
The PED file is a white-space (space or tab) delimited file: the first six columns are mandatory:
Family ID Individual ID Paternal ID Maternal ID
Sex (1=male; 2=female; other=unknown) Phenotype
By default, each line of the MAP file describes a single marker and must contain exactly 4 columns:
chromosome (1-22, X, Y or 0 if unplaced) rs# or snp identifier
Genetic distance (morgans) Base-pair position (bp units)

1.	Convert ped and map files to bim bed and fam

>plink1.9 --file /home/Genotipagem_axiom/patients --make-bed --out patients

 
2.	Add phenotype to fam file
Create the phenotype_patients.txt file in R
File with three columns: Family_ID, sample ID and phenotype Plink code:
-9 missing
0 missing
1 unaffected
2 affected


In the plink, add the phenotypes using this file:
>plink1.9 --bfile patients --pheno phenotype_patients.txt --pheno-merge --make-bed --out patients_pheno

3.	Remove indels and SNPs with more than two alleles
>plink1.9 --bfile patients_pheno --snps-only just-acgt --make-bed --out patients_pheno_noindels
  
4.	Filter MAF (frequency of the smallest allele), GENO (rate of non-genotyped SNPs) and HWE (Eq. Hardy-Weinberg)
--mind Missingness per individual
--geno Missingness per marker

>plink1.9 --bfile patients_pheno_noindels --maf 0.01 --geno 0.1 --hwe 0.000001 --nonfounders --make-bed --out patients_phenoQC

5. Remove unwanted chromosomes (0: unknown, 23: X, 24: Y, 25: homologous XY, 26: mitochondrial)

>plink1.9 --bfile patients_phenoQC --not-chr 0,23-26 --make-bed --keep-allele-order --allow-no-sex --out patients_phenoQC_autosome

7.	Exclusion of heterozygous outliers individuals (heterozygosity >3 standard deviations) and individuals that are not genotyped >3% of the SNPS.

>plink1.9 --bfile patients_phenoQC_autosome --missing --out indiv_missing plink1.9 --bfile patients_phenoQC_autosome --het --out hetero

In R: Create list of individuals to remove: hetero

Removendo indivíduos outliers. linha de comando (não fiz isso):
>plink1.9 --bfile patients_phenoQC_autosome --remove fail-imishet-qc.txt --make-bed --out patients_phenoQC_autosome_semhet

8.	Identity by descent (IBD)

 
 >plink1.9 --bfile patients_phenoQC_autosome_semhet --genome --min 0.2 --nonfounders --outibd_calculation

 Select FID2 and IID2 columns for deletion:
 
 >awk '{ print $3,$4 }' ibd_calculation.genome > individuosrelacionados.txt
 
Exclude individuals with genetic sharing

>plink1.9 --bfile patients_phenoQC_autosome_semhet --remove individuosrelacionados.txt --make-bed --out patient_ibd
